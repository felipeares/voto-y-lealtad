<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="">
		<meta name="author" content="felipeares">
		<!-- <link rel="shortcut icon" href="favicon.ico" type="image/x-icon"> -->
		<title>Lealtad01</title>		
		
		
		<!-- Custom styles for this project -->
		<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
		<link rel="stylesheet" 
		      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" 
			  integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" 
			  crossorigin="anonymous">
		<style>

		body {
			background-color: #ffffff;
			background-image: url("https://www.transparenttextures.com/patterns/gplay.png");
			/* This is mostly intended for prototyping; please download the pattern and re-host for production environments. Thank you! */
			text-align:center;
		}		
		textPath.nombrespartidos {
			font: 8px Verdana, Helvetica, Arial, sans-serif;
			text-transform: uppercase;
		}
		
		image.diputado {
			border: solid 2px #FFF;
			border-radius: 20px;
		}
		
		
      	#tooltip {
	        position: absolute;
	        width: 300px;
	        height: auto;
	        padding: 10px;
	        background-color: white;
	        -webkit-border-radius: 10px;
	        -moz-border-radius: 10px;
	        border-radius: 10px;
	        -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
	        -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
	        box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
	        pointer-events: none;
			z-index: 1000;
      	}

      	#tooltip.hidden {
        	display: none;
      	}
		
		#tooltip-left {
			float:left;
			width:100px;
		}
		
		#tooltip-right {
			float:right;
			width:180px;
			padding-left: 10px;
		}
		
		#tooltip-image {
			width: 100%;
		}
		
		#tooltip-nombre {
			font-size: 16px;
			text-align: left;
			margin: 0px;
		}
		
		#tooltip-partido {
			font-size:12px;
			color: #CCC;
			text-align: left;
			margin: 8px 0px;
			font-weight: 100;
		}
		
		#value {
			margin: 0;
			text-align: left;
			font-size: 12px;
			color: #333;
		}
		
		#buttons-container {
			width:100%;
		}
		
		#buttons-container .nav-item {
			border-right: 1px solid #DDD;
		}
		#buttons-container .nav-item:last-child {
			border-right: none;
		}
		#buttons-container .nav-item .nav-link {
			border-radius: 0px;
			color: #5bc0de;
		}
		#buttons-container .nav-item .nav-link.active {
			background-color: #eceeef;
			color: #292b2c;
			font-weight: 300;
		}
		#pos-container {
			width:100%;
			height:3px;
			background: #EFEFEF;
		}
		#pos {
			position: relative;
			width: 25%;
			height:3px;
			background:#f0ad4e;
			left:0%;
		}
		#expl-container {
			text-align: left;
			padding-top:20px;
			margin-bottom:5px;
		}
		#expl-container h1 {
			font-size:20px;
		}
		#expl-container p {
			font-size:14px;
		}
		#main-container {
			margin-top: 10px;
			margin-bottom: 10px;
		}
		.shadowers {
			background:#FFF;
			-webkit-box-shadow: 1px 1px 11px 1px rgba(0,0,0,0.35);
			-moz-box-shadow: 1px 1px 11px 1px rgba(0,0,0,0.35);
			box-shadow: 1px 1px 11px 1px rgba(0,0,0,0.35);
		}
		#intro {
			text-align: left;
		}
		#intro h1 {
			font-size: 48px;
		}
		
		#felipe-info {
			padding-left: 0px;
			text-align: left;
		}
		#contactoModal {
			text-align: left;
		}

		#felipe-info li {
			list-style: none;
		}

		#felipe-info li i {
			font-size: 34px;
			color: #000;
		}

		#felipe-info li a {
			color: #555;
		    position: relative;
		    top: -7px;
			left: 5px;
			font-weight:100;
		}
		.btn-outline-info.focus, .btn-outline-info:focus {
		    color:#5bc0de;
			box-shadow: none;
		}
		</style>
	</head>
	<body>
		<div id="tooltip" class="hidden">
			<div id="tooltip-left">
				<img id="tooltip-image" src="">
			</div>
			<div id="tooltip-right">
				<h4 id="tooltip-nombre"></h4>
				<h5 id="tooltip-partido"></h5>
				<p id="value"></p>
			</div>
		</div>
		
		<div class="container main" id="main-container">
			
			<div class="row">
				<div class="col-lg-4">
					<div class="jumbotron" id="intro">
					  <h1 class="display-3">Cercanía Legislativa</h1>
					  <p class="lead">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
					  <hr class="my-4">
					  <p>Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
					  <p class="lead">

					  <a href="javascript:" data-toggle="modal" data-target="#comoModal" class="btn btn-outline-info btn-block" role="button">
						  ¿Cómo se armó?
					  </a>
					  <a href="javascript:" data-toggle="modal" data-target="#contactoModal" class="btn btn-outline-info btn-block" role="button">
						  Contacto
					  </a>
					  <a href="https://github.com/felipeares/voto-y-lealtad" class="btn btn-outline-info btn-block" role="button">
						  <i class="fa fa-github" aria-hidden="true"></i> Código en GitHub
					  </a>
					  </p>
					</div>
				</div>
				<div class="col-lg-8">
					<div class="shadowers">
					<div class="row">
						<div class="col-md-12">
							<ul id="buttons-container" class="nav nav-pills nav-justified"></ul>
							<div id="pos-container">
								<div id="pos"></div>
							</div>
							<div class="container" id="expl-container">
								<h1 class="display-3"></h1>
								<p class="lead"></p>
							</div>
						</div>
					</div>
					<div class="row" style="margin: auto; border-top:1px #EEE solid;">
						<div class="col-md-12" style="margin-top: 15px;">
							<div id="graph-container">
								<svg id="graph" width="650" height="650"></svg>
							</div>
						</div>
					</div>
					</div>
				</div>
			</div>	
			
  		  <!-- Contact Modal -->
  		  <div class="modal fade" id="contactoModal" tabindex="-1" role="dialog" aria-labelledby="contactoModalTitle" aria-hidden="true">
  			  <div class="modal-dialog" role="document">
  				  <div class="modal-content">
  					  <div class="modal-header">
  						  <h5 class="modal-title" id="exampleModalLongTitle"><i class="fa fa-paper-plane-o" aria-hidden="true"></i> Contacto</h5>
  						  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
  							  <span aria-hidden="true">&times;</span>
  						  </button>
  					  </div>
  					  <div class="modal-body">
  						  <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum</p>
  					  </div>
  				  </div>
  			  </div>
  		  </div>
					
		</div>
		
		<script
			src="https://code.jquery.com/jquery-3.2.1.min.js"
			integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
			crossorigin="anonymous"></script>
		<script 
			src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" 
			integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" 
			crossorigin="anonymous"></script>
		<script 
			src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" 
			integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" 
			crossorigin="anonymous"></script>
			
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script>			
			graphwidth = Math.min($('#graph-container').width(), 600);
			$('#graph').width(graphwidth);
			$('#graph').height(graphwidth);
						
			var svg = d3.select("svg"),
				width = graphwidth,
				height = graphwidth,
				radiofuera = 32*width/64,
				radionivelbajo = 27*width/64,
				radionivelmedio = 20*width/64,
				radionivelalto = 13*width/64,
				radiocircentro = 6*width/64,
				posiciontextopart = radionivelbajo + (radiofuera-radionivelbajo)/3,
				radiodiputado = 12,
				lealtadajuste = 0,
				partidos = [],
				partidosplacing = [],
				coloresfranjas = ["#CCC", "#DDD", "#EEE"];
			
			var nivelpartidos, 
				nivelbajo, 
				nivelmedio, 
				nivealto, 
				ciculocentro,
				separadores,
				michelle,
				textpath,
				nombrespartidos,
				diputados, 
				diputadoscirculos;
			
			var display = 'sinasistencia',
				selectedbtn = 1;
			
			d3.json("../public/data/diputados.laealtad.json", function(error, graph) {
				if (error) throw error;
				
				diputados = graph.diputados;
				partidos = graph.partidos;
				for (var i=0; i<partidos.length; i++) {
					partidosplacing[i] = 1;
				}
				
				nivelpartidos = svg.append("g")
					.append("circle")
					.attr("r", radiofuera)
					.attr("cx", width/2)
					.attr("cy", height/2)
					.attr("fill", "#3F607D")
					.attr("stroke", "#FFF")
					.attr("stroke-width", 1);
				
				nivelbajo = svg.append("g")
					.append("circle")
					.attr("r", radionivelbajo)
					.attr("cx", width/2)
					.attr("cy", height/2)
					.attr("fill", coloresfranjas[0])
					.attr("stroke", "#FFF")
					.attr("stroke-width", 2);
				
				nivelmedio = svg.append("g")
					.append("circle")
					.attr("r", radionivelmedio)
					.attr("cx", width/2)
					.attr("cy", height/2)
					.attr("fill", coloresfranjas[1]);
				
				nivealto = svg.append("g")
					.append("circle")
					.attr("r", radionivelalto)
					.attr("cx", width/2)
					.attr("cy", height/2)
					.attr("fill", coloresfranjas[2]);
				
				ciculocentro = svg.append("g")
					.append("circle")
					.attr("r", radiocircentro)
					.attr("cx", width/2)
					.attr("cy", height/2)
					.attr("fill", "#FFF");
				
				separadores = svg.append("g")
		      		.selectAll(".separadores")
		      		.data(partidos)
					.enter()
					.append("line")
					.attr("x1", width/2)
					.attr("y1", height/2)
					.attr("x2", width/2)
					.attr("y2", 0 + radiocircentro)
					.attr("stroke-width", 5)
					.attr("stroke", "#fff")
					.attr("transform",function(d,i) { return "rotate(" + 360*i/8 + ", " + width/2 + "," + height/2 + ") translate(0," + -1*radiocircentro + ")"; });
				
				michelle = svg.append("g")
					.append("svg:image")
					.attr("xlink:href",  "../michelle.jpg")
					.attr("height", radiocircentro*1.2)
			        .attr("width", radiocircentro*1.2)
					.attr("x", width/2 - 1.2*radiocircentro/2)
			        .attr("y", height/2 - 1.2*radiocircentro/2);
				
				textpath = svg.append("path")
					.attr("id", "textpath")
					.attr("d", "M " + width/2 + ", " + height/2 + " m -" + posiciontextopart + ", 0 a " + posiciontextopart + "," + posiciontextopart + " 0 1,1 " + 2*posiciontextopart + ",0 a " + posiciontextopart + "," + posiciontextopart + " 0 1,1 -" + 2*posiciontextopart + ",0")
					.style("fill", "none");
				nombrespartidos = svg.append("text")
		      		.selectAll(".nombrespartidoscirc")
		      		.data(partidos)
					.enter()
				   	.append("textPath")
					.attr("xlink:href", "#textpath") 
					.style("text-anchor","middle") 
					.style("fill","#FFF") 
					.attr("startOffset", function(d,i) {return (100/8)/2 + 100*i/8 + "%"; })		
					.text(function (d,i) { return d; })
					.attr("class","nombrespartidos");
				
				
				diputadoscirculos = svg.append("g")
					.selectAll("diputados")
					.data(diputados)
					.enter().append("g")
					.attr("class", "diputados")
					.attr("transform",function(d,i) { 
						var partidoindex = partidos.indexOf(d.comite_parlamentario);
						var lealtad = Math.max(0, (d.lealtad - lealtadajuste)/(1 - lealtadajuste))
						var mov = partidosplacing[partidoindex]*(Math.random(0,1))*(360/8)/4;
						var rotate = "rotate(" + ((360/8)/2 - 90 + mov + 360*partidoindex/8) + ", " + width/2 + "," + height/2 + ")";
						var translate = "translate(0,-" + (radiocircentro + (1-lealtad)*(radionivelbajo - radiocircentro)) + ")"
						partidosplacing[partidoindex] = partidosplacing[partidoindex]*-1
						return rotate + " " + translate; 
					})
					.on("mouseover", function(d) {
						
						var selection = d3.select("#tooltip")
							.style("left", (d3.event.pageX) + "px")
							.style("top", (d3.event.pageY) + "px")
							.style("background-color", "#FFF")
							.classed("hidden", false);						
					  
						selection.select("#tooltip-image")
							.attr("src", "https://www.camara.cl/img.aspx?prmid=g" + d.prmid);
											  
						selection.select("#tooltip-nombre")
							.html(d.nombre)
						
						selection.select("#tooltip-partido")
							.html(d.comite_parlamentario)
												
						selection.select("#value")
							.html("Votos a Favor: " + d.favor + "<br>" + "Votos en Contra: " + d.contra + "<br>" + "Abstenciones: " + d.abstencion + "<br>" + "Inasistencias: " + d.ausencia);	
					})
	  			  	.on("mouseout", function(d){
						d3.select("#tooltip").classed("hidden", true);
					});
					
				 
				 
				diputadoscirculos.append("circle")
					.attr("class", "diputado-circulo")
					.attr("r", radiodiputado)
					.attr("stroke", "#FFF")
					.attr("fill", "#53A0B8")
					.attr("cx", width/2 - radiodiputado/2)
					.attr("cy", height/2 + radiodiputado/2)
				
				diputadoscirculos.append("svg:image")
					.attr("class", "diputado-imagen")
					.attr("xlink:href",  function(d) { return "https://www.camara.cl/img.aspx?prmid=chs" + d.prmid; })
					.attr("height", radiodiputado)
			        .attr("width", radiodiputado)
					.attr("x", width/2 - 10)
			        .attr("y", height/2);				
			});
		
			function mostrarLealtadSinAsistencia() {
				display = 'sinasistencia';
				
				diputadoscirculos.transition().duration(750).attr("transform",function(d,i) { 
					var partidoindex = partidos.indexOf(d.comite_parlamentario);
					var lealtad = Math.max(0, (d.lealtad - lealtadajuste)/(1 - lealtadajuste))
					var mov = partidosplacing[partidoindex]*(Math.random(0,1))*(360/8)/4;
					var rotate = "rotate(" + ((360/8)/2 - 90 + mov + 360*partidoindex/8) + ", " + width/2 + "," + height/2 + ")";
					var translate = "translate(0,-" + (radiocircentro + (1-lealtad)*(radionivelbajo - radiocircentro)) + ")"
					partidosplacing[partidoindex] = partidosplacing[partidoindex]*-1
					return rotate + " " + translate; 
				});
			}
			
			function mostrarLealtadConAsistencia() {
				display = 'conasistencia';
				
				diputadoscirculos.transition().duration(750).attr("transform",function(d,i) { 
					var partidoindex = partidos.indexOf(d.comite_parlamentario);
					var lealtad = Math.max(0, (d.lealtad_con_asistencia - lealtadajuste)/(1 - lealtadajuste))
					var mov = partidosplacing[partidoindex]*(Math.random(0,1))*(360/8)/4;
					var rotate = "rotate(" + ((360/8)/2 - 90 + mov + 360*partidoindex/8) + ", " + width/2 + "," + height/2 + ")";
					var translate = "translate(0,-" + (radiocircentro + (1-lealtad)*(radionivelbajo - radiocircentro)) + ")"
					partidosplacing[partidoindex] = partidosplacing[partidoindex]*-1
					return rotate + " " + translate; 
				});
			}
			
			function mostrarLealtadSoloReprobados() {
				display = 'soloreprobados';
				
				diputadoscirculos.transition().duration(750).attr("transform",function(d,i) { 
					var partidoindex = partidos.indexOf(d.comite_parlamentario);
					var lealtad = Math.max(0, (d.lealtad_rec - lealtadajuste)/(1 - lealtadajuste))
					var mov = partidosplacing[partidoindex]*(Math.random(0,1))*(360/8)/4;
					var rotate = "rotate(" + ((360/8)/2 - 90 + mov + 360*partidoindex/8) + ", " + width/2 + "," + height/2 + ")";
					var translate = "translate(0,-" + (radiocircentro + (1-lealtad)*(radionivelbajo - radiocircentro)) + ")"
					partidosplacing[partidoindex] = partidosplacing[partidoindex]*-1
					return rotate + " " + translate; 
				});
			}
			
			function mostrarLealtadPrimerTramite() {
				display = 'primertramite';
				
				diputadoscirculos.transition().duration(750).attr("transform",function(d,i) { 
					var partidoindex = partidos.indexOf(d.comite_parlamentario);
					var lealtad = Math.max(0, (d.lealtad_tr01 - lealtadajuste)/(1 - lealtadajuste))
					var mov = partidosplacing[partidoindex]*(Math.random(0,1))*(360/8)/4;
					var rotate = "rotate(" + ((360/8)/2 - 90 + mov + 360*partidoindex/8) + ", " + width/2 + "," + height/2 + ")";
					var translate = "translate(0,-" + (radiocircentro + (1-lealtad)*(radionivelbajo - radiocircentro)) + ")"
					partidosplacing[partidoindex] = partidosplacing[partidoindex]*-1
					return rotate + " " + translate; 
				});
			}
			
			function cambiarTipo(n) {
				var btn = contents[n-1];
				var ths = $('#btn_' + n)
				
				btn.action();
				
				
				$('#pos').animate({
					left: (n-1)*25 + '%',
				}, {
					duration: 500,
					complete: function() {
						$('#expl-container h1').text(btn.title);
						$('#expl-container p').text(btn.body);	
						$('#buttons-container a.nav-link').removeClass('active');
						ths.addClass('active');					
					}
				});
			}
			
			var contents = [
				{
					n: 1,
					button: "General",
					title: "Índice de cercanía legislativa - Todos",
					body: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum",
					action: mostrarLealtadSinAsistencia
				},
				{
					n: 2,
					button: "Sólo Asistentes",
					title: "Tomando en cuenta sólo las sesiones en la que asistieron",
					body: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum",
					action: mostrarLealtadConAsistencia
				},
				{
					n: 3,
					button: "Primer Trámite",
					title: "Tomando en cuenta sólo Primer Trámite - Primer Informe",
					body: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum",
					action: mostrarLealtadPrimerTramite
				},
				{
					n: 4,
					button: "Rechazados",
					title: "Tomando en cuenta sólo los proyectos finalmente rechazados",
					body: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum",
					action: mostrarLealtadSoloReprobados
				}
			];
			
			for (var i = 0; i < contents.length; i++) {
				btn = contents[i];
				$('#buttons-container').append('<li class="nav-item"><a id="btn_' + btn.n + '" data-n="' + btn.n + '" class="nav-link ' + (i==0 ? 'active' : '') + '" href="javascript:">' + btn.button + '</a></li>');
			}
			$('#expl-container h1').text(contents[0].title);
			$('#expl-container p').text(contents[0].body);
			
			var automatico = setInterval(cambiarAuto, 5000);
			var counter = 1;
			function cambiarAuto() {
			    if (counter == 4) {
			    	counter = 1;
			    }
				else {
					counter ++;
				}
				cambiarTipo(counter);
			}
			
			$('#buttons-container a.nav-link').click(function() {
				clearInterval(automatico);
				
				var n = $(this).data('n');
				cambiarTipo(n);
			});
			
			
			


		</script>
	</body>
</html>